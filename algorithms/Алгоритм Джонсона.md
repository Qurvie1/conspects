Хотим, чтоб [[Алгоритм Дейкстры|Дейкстра]] работала даже на отрицательных весах, но что для этого можно сделать?

По сути, прибавив ко всем весам константу мы проблему не решим и получать будем неверные значения.

Хотим ввести **потенциал**. И прибавим каждому ребру свой потенциал.

Пусть новый вес ребра $w'(x, y) = w(x, y) + \phi(x) - \phi(y)$

$\phi$ - некая функция на вершинах (потенциал).

Изменится ли длина пути из $v$ в $u$ - да, но на разность потенциалов.

$dist(v, u)' = dist(v, u) + \phi(v) - \phi(u)$

Кратчайший путь не изменится, а изменится только его вес.

А у циклов вообще ничего не поменяется.

Как ввести этот потенциал? Добавим фиктивную вершину и проведём рёбра во все вершины (и вес этих рёбер 0). Потом запустим [[Алгоритм Форда-Беллмана]] чтоб найти кратчайшие расстояния от этой фиктивной вершины до всех остальных.

**Теорема**. Веса будут $\geq 0$.

$w' = w + \phi(v) - \phi(u) = w + \rho(s^{*}, v) - \rho(s^{*}, u) \geq 0$

Это верно, так как путь до вершины $u$ через $v$ и ребро с весом $w$ не меньше, чем кратчайший путь.

Потом ищем кратчайшие пути из каждой вершины с помощью Дейкстры.

Сложность - $O(VE + VE\lg V)$ или $O(VE + V(E + V^{2}))$ в зависимости от реализации Дейкстры.

То есть в целом $O(V^{2}\lg V)$ или $O(V^{3})$ до разреженных или плотных графов соответственно.
